# https://bazel.build/reference/command-line-reference

import %workspace%/bazel/bazelrc/preset.bazelrc
import %workspace%/bazel/bazelrc/profile.bazelrc

# Enable the protoc toolchain support, introduced in Bazel 7.
common --incompatible_enable_proto_toolchain_resolution

# https://bazel.build/docs/user-manual#workspace_status
common:stamp --stamp --workspace_status_command=stamp/buildinfo.sh

# This parameter is experimental and may change at any time. Please do not depend on it.
#
# If true, this usage of the module extension will be isolated from all other usages, both in this and other modules.
# Tags created for this usage do not affect other usages and the repositories generated by the extension
# for this usage will be distinct from all other repositories generated by the extension.
#
# https://bazel.build/rules/lib/globals/module
common --experimental_isolated_extension_usages

# Use a directory on the file system as a remote cache.
# By default, Bazel has a build cache per workspace which keeps only the latest version
# of any target. Disk cache is useful for sharing build artifacts when switching branches
# and/or working on multiple workspaces of the same project, such as multiple checkouts.
#
# Since Bazel does not garbage-collect the directory,
# you might want to automate a periodic cleanup of this directory.
common:ci --disk_cache=~/.cache/bazel/disk/

# The repository cache is shared between all workspaces and installed versions of bazel.
# https://bazel.build/run/build#repository-cache
common:ci --repository_cache=~/.cache/bazel/repository/

# Collect garbage entries from the disk cache.
#
# https://bazel.build/reference/command-line-reference#flag--experimental_disk_cache_gc_max_size
# https://bazel.build/reference/command-line-reference#flag--experimental_disk_cache_gc_max_age
common:ci --experimental_disk_cache_gc_max_size=10G
common:ci --experimental_disk_cache_gc_max_age=7d

# Load extra bazel settings if any.
try-import %workspace%/.bazelrc.local
